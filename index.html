<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ad Player con bottone start</title>
  <style>
    :root { --bg:#000; --fg:#fff; }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:var(--bg);color:var(--fg);font-family:system-ui,Arial,sans-serif}
    #stage{height:100%;display:flex;align-items:center;justify-content:center;position:relative;padding:12px}
    img#ad { max-width:92vw; max-height:86vh; border-radius:10px; display:none; }
    /* countdown in alto a sinistra */
    #hud { position:fixed; top:10px; left:10px; z-index:9999; display:flex; gap:8px; align-items:center; }
    #counter { background:rgba(0,0,0,.6); padding:6px 10px; border-radius:8px; font-weight:800; font-size:18px; display:none; }
    #closeBtn { display:none; background:#e11; color:#fff; border:none; padding:6px 10px; border-radius:8px; cursor:pointer; font-weight:800 }
    #startBtn { background:#1a1; color:#fff; border:none; padding:14px 20px; border-radius:10px; cursor:pointer; font-size:20px; font-weight:800 }
    #log { position:fixed; left:12px; right:12px; bottom:12px; max-height:26vh; overflow:auto; font-size:13px;
          background:rgba(0,0,0,0.6); padding:8px; border-radius:10px; color:#ddd; }
    .err{color:#ff9b9b}
  </style>
</head>
<body>
  <div id="stage">
    <button id="startBtn">â–¶ Riproduci</button>
    <img id="ad" src="" alt="Ad">
  </div>

  <div id="hud">
    <div id="counter">8</div>
    <button id="closeBtn">âœ•</button>
  </div>

  <div id="log" aria-live="polite"></div>

  <audio id="audio" preload="auto" playsinline></audio>

<script>
/* ---------------- CONFIG ---------------- */
const TOTAL_ADS = 1; // ðŸ‘ˆ QUI cambi il numero di ads disponibili (ad1...adN)

/* ---------------- Variabili UI ---------------- */
const LOG = document.getElementById('log');
const imgEl = document.getElementById('ad');
const audioEl = document.getElementById('audio');
const startBtn = document.getElementById('startBtn');
const counterEl = document.getElementById('counter');
const closeBtn = document.getElementById('closeBtn');

/* Funzione log debug */
function log(msg,isErr=false){
  console.log(msg);
  const p=document.createElement('div');
  if(isErr)p.classList.add('err');
  p.textContent=msg;
  LOG.appendChild(p);
  LOG.scrollTop=LOG.scrollHeight;
}

/* Funzione principale che parte SOLO al click */
function startAd(){
  startBtn.style.display="none"; // sparisce il bottone
  log("Avvio annuncio...");

  // Scegli un indice casuale
  const adIndex=Math.floor(Math.random()*TOTAL_ADS)+1;
  log("Indice scelto: ad"+adIndex);

  const imgBasename="ad"+adIndex;
  const imgCandidates=[imgBasename+".png",imgBasename+".jpg",imgBasename+".jpeg"];
  const audioBasename="adaudio"+adIndex+".mp3";

  // carica immagine
  function tryNextImage(list){
    if(list.length===0){ log("Nessuna immagine trovata per: "+imgBasename,true); return; }
    const attempt=list.shift();
    imgEl.src=attempt;
    imgEl.onload=()=>{ log("Immagine caricata: "+attempt); imgEl.style.display="block"; };
    imgEl.onerror=()=>{ log("Immagine non trovata: "+attempt); tryNextImage(list); };
  }
  tryNextImage(imgCandidates.slice());

  // prepara audio
  audioEl.src=audioBasename;
  audioEl.oncanplay=()=>{ log("Audio pronto: "+audioBasename); audioEl.play().catch(()=>log("Audio avviabile solo dopo interazione.")); };
  audioEl.onerror=()=>{ log("Audio non trovato: "+audioBasename); };

  // avvia timer
  let seconds=8;
  counterEl.style.display="block";
  counterEl.textContent=seconds;
  const timerId=setInterval(()=>{
    seconds--;
    counterEl.textContent=seconds;
    if(seconds<=0){
      clearInterval(timerId);
      counterEl.style.display='none';
      closeBtn.style.display='inline-block';
    }
  },1000);
}

/* click del bottone start */
startBtn.addEventListener('click', startAd);

/* click chiusura */
closeBtn.addEventListener('click',()=>{
  log("Chiusura richiesta dall'utente.");
  try{ window.close(); }catch(e){}
  setTimeout(()=>{ document.body.innerHTML="<h2 style='color:white;text-align:center;margin-top:30vh'>Annuncio chiuso</h2>"; },150);
});
</script>
</body>
</html>
